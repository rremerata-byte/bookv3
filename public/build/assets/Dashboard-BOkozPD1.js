import{L as x}from"./FrontEndLayout-BB7Mop1q.js";import{C as f,r as w}from"./charts-8SaNzrGi.js";import{l as p,r as v,b as y,w as C,o as h,e,t as i,f as b,i as u,z as g,F as m}from"./vendor-D6j6WTf-.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";f.register(...w);const k={components:{Link:p,Layout:x},props:{stats:Object,loginsData:Object,borrowMonthly:Array,reserveMonthly:Array,monthLabels:Array,borrowYearly:Array,reserveYearly:Array,yearLabels:Array,topBooks:Array,topRequestUsers:Array,bookActions:Array},mounted(){this.initChart(),this.initYearChart(),this.$nextTick(()=>{this.animateTopBars()})},data(){return{borrowChart:null,borrowYearChart:null}},computed:{topBooksMax(){return!this.topBooks||!this.topBooks.length?1:Math.max(...this.topBooks.map(o=>o.count||0))},topRequestUsersMax(){return!this.topRequestUsers||!this.topRequestUsers.length?1:Math.max(...this.topRequestUsers.map(o=>o.total_requests||0))}},methods:{initChart(){if(this.$refs.borrowChartCanvas){const o=this.$refs.borrowChartCanvas.getContext("2d");if(this.borrowChart){try{this.borrowChart.destroy()}catch{}this.borrowChart=null}const t=o.createLinearGradient(0,0,0,200);t.addColorStop(0,"rgba(99,102,241,0.85)"),t.addColorStop(1,"rgba(99,102,241,0.1)");const r=o.createLinearGradient(0,0,0,200);r.addColorStop(0,"rgba(16,185,129,0.85)"),r.addColorStop(1,"rgba(16,185,129,0.08)");const n=new f(o,{type:"line",data:{labels:this.monthLabels||["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],datasets:[{label:"Borrows",data:this.borrowMonthly||[],fill:!0,backgroundColor:t,borderColor:"rgba(99,102,241,1)",pointBackgroundColor:"#fff",pointBorderColor:"rgba(99,102,241,1)",tension:.35,pointRadius:4,borderWidth:2,yAxisID:"y"},{label:"Reservations",data:this.reserveMonthly||[],fill:!0,backgroundColor:r,borderColor:"rgba(16,185,129,1)",pointBackgroundColor:"#fff",pointBorderColor:"rgba(16,185,129,1)",tension:.35,pointRadius:4,borderWidth:2,yAxisID:"y"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{labels:{color:"#334155",usePointStyle:!0,padding:16}},tooltip:{backgroundColor:"#0f172a",titleColor:"#fff",bodyColor:"#e6eef8",padding:10,cornerRadius:6}},scales:{x:{grid:{display:!1},ticks:{color:"#475569",maxRotation:0}},y:{beginAtZero:!0,grid:{color:"rgba(15,23,42,0.06)"},ticks:{color:"#475569",stepSize:1}}}}});this.borrowChart=n}},initYearChart(){if(this.$refs.borrowYearChartCanvas){const o=this.$refs.borrowYearChartCanvas.getContext("2d");if(this.borrowYearChart){try{this.borrowYearChart.destroy()}catch{}this.borrowYearChart=null}const t=o.createLinearGradient(0,0,0,120);t.addColorStop(0,"rgba(99,102,241,0.85)"),t.addColorStop(1,"rgba(99,102,241,0.12)");const r=o.createLinearGradient(0,0,0,120);r.addColorStop(0,"rgba(16,185,129,0.85)"),r.addColorStop(1,"rgba(16,185,129,0.12)");const n=new f(o,{type:"bar",data:{labels:this.yearLabels||[],datasets:[{label:"Borrows",data:this.borrowYearly||[],backgroundColor:t,borderColor:"rgba(99,102,241,1)",borderWidth:1},{label:"Reservations",data:this.reserveYearly||[],backgroundColor:r,borderColor:"rgba(16,185,129,1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{labels:{color:"#334155",padding:12}},tooltip:{backgroundColor:"#0f172a",titleColor:"#fff",bodyColor:"#e6eef8",padding:8,cornerRadius:6}},scales:{x:{grid:{display:!1},ticks:{color:"#475569"}},y:{beginAtZero:!0,grid:{color:"rgba(15,23,42,0.06)"},ticks:{color:"#475569"}}}}});this.borrowYearChart=n}},formatDate(o){return new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},downloadChartPNG(){try{const o=new Date().getFullYear();if(!this.borrowChart){const n=this.$refs.borrowChartCanvas;if(!n)return;const l=n.toDataURL("image/png"),a=document.createElement("a");a.href=l,a.download=`monthly-borrows-reservations-${o}.png`,document.body.appendChild(a),a.click(),a.remove();return}const t=this.borrowChart.toBase64Image(),r=document.createElement("a");r.href=t,r.download=`monthly-borrows-reservations-${o}.png`,document.body.appendChild(r),r.click(),r.remove()}catch(o){console.error("Export PNG failed",o)}},downloadChartCSV(){try{const o=new Date().getFullYear(),t=this.monthLabels||["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=this.borrowMonthly||Array(12).fill(0),n=this.reserveMonthly||Array(12).fill(0);let l=`Month,Borrows,Reservations
`;for(let c=0;c<t.length;c++)l+=`${t[c]},${r[c]??0},${n[c]??0}
`;const a=new Blob([l],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(a),s=document.createElement("a");s.href=d,s.download=`monthly-borrows-reservations-${o}.csv`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(d)}catch(o){console.error("Export CSV failed",o)}}},downloadYearChartPNG(){try{const o=(this.yearLabels||[]).join("-")||new Date().getFullYear();if(!this.borrowYearChart){const n=this.$refs.borrowYearChartCanvas;if(!n)return;const l=n.toDataURL("image/png"),a=document.createElement("a");a.href=l,a.download=`yearly-borrows-reservations-${o}.png`,document.body.appendChild(a),a.click(),a.remove();return}const t=this.borrowYearChart.toBase64Image(),r=document.createElement("a");r.href=t,r.download=`yearly-borrows-reservations-${o}.png`,document.body.appendChild(r),r.click(),r.remove()}catch(o){console.error("Export Year PNG failed",o)}},downloadYearChartCSV(){try{const o=this.yearLabels||[],t=this.borrowYearly||[],r=this.reserveYearly||[];let n=`Year,Borrows,Reservations
`;for(let s=0;s<o.length;s++)n+=`${o[s]},${t[s]??0},${r[s]??0}
`;const l=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(l),d=document.createElement("a");d.href=a,d.download=`yearly-borrows-reservations-${o.join("-")||new Date().getFullYear()}.csv`,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(a)}catch(o){console.error("Export Year CSV failed",o)}},animateTopBars(){try{this.$el.querySelectorAll(".progress-bar-inner").forEach((t,r)=>{const n=t.getAttribute("data-width")||t.dataset.width||"0%";t.style.width="0%",setTimeout(()=>{t.style.width=n},120+r*90)})}catch(o){console.error("animateTopBars error",o)}}},B={class:"ml-64 min-h-screen p-0 flex-1 bg-gradient-to-br from-blue-50 to-blue-200"},R={class:"max-w-7xl mx-auto py-10 px-4"},Y={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mb-10"},A={class:"bg-gradient-to-br from-blue-200 to-blue-400 p-6 rounded-2xl shadow-lg flex flex-col items-center hover:scale-105 transition-transform"},L={class:"text-3xl font-extrabold text-white"},S={class:"bg-gradient-to-br from-green-200 to-green-400 p-6 rounded-2xl shadow-lg flex flex-col items-center hover:scale-105 transition-transform"},M={class:"text-3xl font-extrabold text-white"},U={class:"bg-gradient-to-br from-yellow-200 to-yellow-400 p-6 rounded-2xl shadow-lg flex flex-col items-center hover:scale-105 transition-transform"},D={class:"text-3xl font-extrabold text-white"},q={class:"bg-gradient-to-br from-purple-200 to-purple-400 p-6 rounded-2xl shadow-lg flex flex-col items-center hover:scale-105 transition-transform"},j={class:"text-3xl font-extrabold text-white"},G={class:"text-sm text-white mt-2"},N={class:"font-semibold"},E={class:"mt-6 bg-white p-6 rounded-lg shadow-lg"},T={class:"flex items-start justify-between mb-4"},V={class:"flex items-center space-x-2"},P={class:"w-full h-72"},$={ref:"borrowChartCanvas",class:"w-full h-full"},F={class:"mt-6 bg-white p-6 rounded-lg shadow-lg"},O={class:"flex items-start justify-between mb-4"},J={class:"flex items-center space-x-2"},I={class:"w-full h-60"},W={ref:"borrowYearChartCanvas",class:"w-full h-full"},z={class:"mt-8 bg-gradient-to-br from-white to-slate-50 p-6 rounded-2xl shadow-xl"},Z={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},H={class:"flex-shrink-0 w-14 h-14 rounded-lg bg-gradient-to-br from-indigo-50 to-indigo-100 flex items-center justify-center text-indigo-700 font-semibold text-lg shadow-sm"},K={class:"text-sm"},Q={class:"flex-1 min-w-0"},X={class:"flex items-center justify-between"},tt={class:"text-gray-800 font-semibold truncate"},et={class:"text-indigo-600 font-bold text-lg"},ot={class:"mt-3 h-2 bg-indigo-100 rounded-full overflow-hidden"},rt=["data-width"],st={class:"mt-8 bg-gradient-to-br from-white to-slate-50 p-6 rounded-2xl shadow-xl"},at={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},nt={class:"flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-emerald-50 to-emerald-100 flex items-center justify-center text-emerald-700 font-semibold shadow-sm"},lt={class:"flex-1 min-w-0"},it={class:"flex items-center justify-between"},dt={class:"text-gray-800 font-semibold truncate"},ct={class:"text-emerald-600 font-bold text-lg"},ht={class:"mt-3 h-2 bg-emerald-100 rounded-full overflow-hidden"},bt=["data-width"];function ut(o,t,r,n,l,a){const d=v("Layout");return h(),y(d,null,{default:C(()=>[e("div",B,[e("div",R,[e("div",Y,[e("div",A,[t[4]||(t[4]=e("i",{class:"fas fa-book text-4xl text-white mb-3"},null,-1)),t[5]||(t[5]=e("h3",{class:"text-lg font-semibold text-white mb-1"},"Total Books",-1)),e("p",L,i(r.stats.totalBooks),1)]),e("div",S,[t[6]||(t[6]=e("i",{class:"fas fa-book-reader text-4xl text-white mb-3"},null,-1)),t[7]||(t[7]=e("h3",{class:"text-lg font-semibold text-white mb-1"},"Total Borrows",-1)),e("p",M,i(r.stats.totalBorrowings),1)]),e("div",U,[t[8]||(t[8]=e("i",{class:"fas fa-undo-alt text-4xl text-white mb-3"},null,-1)),t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-white mb-1"},"Total Returns",-1)),e("p",D,i(r.stats.totalReturns),1)]),e("div",q,[t[12]||(t[12]=e("i",{class:"fas fa-users text-4xl text-white mb-3"},null,-1)),t[13]||(t[13]=e("h3",{class:"text-lg font-semibold text-white mb-1"},"Active Borrowings",-1)),e("p",j,i(r.stats.activeBorrowings),1),e("p",G,[t[10]||(t[10]=b("Active reservations: ")),e("span",N,i(r.stats.activeReservations),1),t[11]||(t[11]=e("span",{class:"ml-2 text-xs opacity-80",title:"Active borrowings counts unique books currently borrowed (not returned). Active reservations counts unique approved reservations with until date today or later."},"ℹ️",-1))])])]),e("div",E,[e("div",T,[t[16]||(t[16]=e("h3",{class:"text-xl font-bold text-gray-800"},"Monthly Borrows & Reservations",-1)),e("div",V,[e("button",{onClick:t[0]||(t[0]=(...s)=>a.downloadChartPNG&&a.downloadChartPNG(...s)),class:"inline-flex items-center px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm"},t[14]||(t[14]=[e("i",{class:"fas fa-download mr-2"},null,-1),b(" PNG ")])),e("button",{onClick:t[1]||(t[1]=(...s)=>a.downloadChartCSV&&a.downloadChartCSV(...s)),class:"inline-flex items-center px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm"},t[15]||(t[15]=[e("i",{class:"fas fa-file-csv mr-2"},null,-1),b(" CSV ")]))])]),e("div",P,[e("canvas",$,null,512)])]),e("div",F,[e("div",O,[t[19]||(t[19]=e("h3",{class:"text-xl font-bold text-gray-800"},"Yearly Borrows & Reservations",-1)),e("div",J,[e("button",{onClick:t[2]||(t[2]=(...s)=>o.downloadYearChartPNG&&o.downloadYearChartPNG(...s)),class:"inline-flex items-center px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm"},t[17]||(t[17]=[e("i",{class:"fas fa-download mr-2"},null,-1),b(" PNG ")])),e("button",{onClick:t[3]||(t[3]=(...s)=>o.downloadYearChartCSV&&o.downloadYearChartCSV(...s)),class:"inline-flex items-center px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm"},t[18]||(t[18]=[e("i",{class:"fas fa-file-csv mr-2"},null,-1),b(" CSV ")]))])]),e("div",I,[e("canvas",W,null,512)])]),e("div",z,[t[21]||(t[21]=e("h3",{class:"text-xl font-bold text-gray-800 mb-4"},"Top 5 Most Borrowed Books",-1)),e("div",Z,[(h(!0),u(m,null,g(r.topBooks,(s,c)=>(h(),u("div",{key:s.title,class:"flex items-center space-x-4 p-4 bg-white/80 backdrop-blur-sm border border-transparent hover:border-indigo-100 rounded-xl transition-shadow transition-transform hover:shadow-2xl hover:-translate-y-1"},[e("div",H,[e("div",K,"#"+i(c+1),1)]),e("div",Q,[e("div",X,[e("div",tt,i(s.title),1),e("div",et,i(s.count),1)]),t[20]||(t[20]=e("p",{class:"text-xs text-gray-400 mt-1 truncate"},"Total borrows",-1)),e("div",ot,[e("div",{class:"h-full rounded-full progress-bar-inner transition-width","data-width":Math.max(6,Math.round(s.count/a.topBooksMax*100))+"%",style:{background:"linear-gradient(90deg,#6366f1,#7c3aed)",width:"0%"}},null,8,rt)])])]))),128))])]),e("div",st,[t[23]||(t[23]=e("h3",{class:"text-xl font-bold text-gray-800 mb-4"},"Top 5 Most Request Users",-1)),e("div",at,[(h(!0),u(m,null,g(r.topRequestUsers,(s,c)=>(h(),u("div",{key:s.fullname,class:"flex items-center space-x-4 p-4 bg-white/80 backdrop-blur-sm border border-transparent hover:border-green-100 rounded-xl transition-shadow transition-transform hover:shadow-2xl hover:-translate-y-1"},[e("div",nt,i(s.fullname.charAt(0).toUpperCase()),1),e("div",lt,[e("div",it,[e("div",dt,i(s.fullname),1),e("div",ct,i(s.total_requests),1)]),t[22]||(t[22]=e("p",{class:"text-xs text-gray-400 mt-1 truncate"},"Requests (borrow & reserve)",-1)),e("div",ht,[e("div",{class:"h-full rounded-full progress-bar-inner transition-width","data-width":Math.max(6,Math.round(s.total_requests/a.topRequestUsersMax*100))+"%",style:{background:"linear-gradient(90deg,#10b981,#059669)",width:"0%"}},null,8,bt)])])]))),128))])])])])]),_:1})}const wt=_(k,[["render",ut],["__scopeId","data-v-ad44291e"]]);export{wt as default};
